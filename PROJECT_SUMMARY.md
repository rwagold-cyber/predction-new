# PredictX V2 é¡¹ç›®æ€»ç»“

## é¡¹ç›®æ¦‚è¿°

PredictX V2 æ˜¯ä¸€ä¸ªåŸºäº CTF (Conditional Token Framework) çš„é«˜æ€§èƒ½é¢„æµ‹å¸‚åœºå¹³å°ï¼Œé‡‡ç”¨é“¾ä¸‹è®¢å•ç°¿ + é“¾ä¸Šç»“ç®—çš„æ··åˆæ¶æ„ï¼Œæ”¯æŒ BTC/ETH ä»·æ ¼çŸ­æœŸé¢„æµ‹ï¼ˆ1åˆ†é’Ÿ/3åˆ†é’Ÿ/5åˆ†é’Ÿï¼‰ã€‚

**æ¶æ„ç‰ˆæœ¬**: V2 (CTF + é“¾ä¸‹æ’®åˆ)
**éƒ¨ç½²ç½‘ç»œ**: Socrates Testnet (Chain ID: 1111111)
**é¢„è¨€æœº**: Pyth Oracle (æ•´åˆ†é’Ÿä»·æ ¼)
**ä»·æ ¼ç²¾åº¦**: BPS (basis points, 0-10000)

## æ ¸å¿ƒæŠ€æœ¯æ ˆ

### æ™ºèƒ½åˆçº¦ V2 (Solidity 0.8.24)
- **ConditionalTokensV2**: CTF ä¸»åˆçº¦ (ERC1155 ä»“ä½ä»£å¸)
- **SettlementV2**: è®¢å•ç»“ç®— + CTF é›†æˆ
- **MarketRegistryV2**: å¸‚åœºç®¡ç† + Oracle é›†æˆ
- **PythOracleAdapter**: Oracle ä»·æ ¼é€‚é…å™¨

### åç«¯æœåŠ¡ V2 (Node.js + TypeScript)
- **API Server**: REST API (è®¢å•æäº¤/æŸ¥è¯¢)
- **Matching Engine**: ä»·æ ¼-æ—¶é—´ä¼˜å…ˆè®¢å•ç°¿æ’®åˆ
- **Relayer**: æ‰¹é‡é“¾ä¸Šç»“ç®—æœåŠ¡
- **EIP-712**: è®¢å•ç­¾åéªŒè¯

### å‰ç«¯ (React + Vite + TypeScript)
- **é’±åŒ…é›†æˆ**: ethers.js v6
- **å¸‚åœºå±•ç¤º**: å®æ—¶å¸‚åœºåˆ—è¡¨
- **è®¢å•ç°¿**: ä¹°å–è®¢å•å±•ç¤º
- **äº¤æ˜“ç•Œé¢**: ç®€å•çš„ä¸‹å•ç•Œé¢

## å·²å®ç°åŠŸèƒ½ï¼ˆV2 æ¶æ„ï¼‰

### âœ… æ ¸å¿ƒåŠŸèƒ½
1. **æ™ºèƒ½åˆçº¦ V2**
   - âœ… CTF (ERC1155): split/merge/redeem/prepareCondition/reportPayouts
   - âœ… å¸‚åœºåˆ›å»º: createMarket(collateral, oracle, startTime, kind, timeframe)
   - âœ… å¸‚åœºç±»å‹: BTC_UPDOWN / ETH_UPDOWN
   - âœ… æ—¶é—´æ¡†æ¶: 1/3/5 åˆ†é’Ÿ
   - âœ… Oracle ä»·æ ¼è·å–å’Œç»“ç®—
   - âœ… EIP-712 è®¢å•ç­¾åéªŒè¯
   - âœ… æ‰¹é‡ç»“ç®—: batchFill()
   - âœ… ä»·æ ¼ç²¾åº¦: BPS (0-10000)

2. **åç«¯æœåŠ¡ V2**
   - âœ… REST API (è®¢å•/è®¢å•ç°¿/ç»Ÿè®¡)
   - âœ… æ’®åˆå¼•æ“ (ä»·æ ¼-æ—¶é—´ä¼˜å…ˆ)
   - âœ… è‡ªåŠ¨æ’®åˆ (æ¯ 5 ç§’)
   - âœ… Relayer æ‰¹é‡æäº¤ (10ç¬”/æ‰¹)
   - âœ… Gas ä»·æ ¼ç›‘æ§
   - âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶
   - âœ… å®Œæ•´ API æ–‡æ¡£

3. **å‰ç«¯ç•Œé¢**
   - âœ… é’±åŒ…è¿æ¥
   - âœ… å¸‚åœºåˆ—è¡¨
   - âœ… è®¢å•ç°¿å±•ç¤º
   - âœ… ä¸‹å•åŠŸèƒ½

### âš ï¸ ç”Ÿäº§ç¯å¢ƒå¢å¼ºå»ºè®®

1. **è®¢å•å­˜å‚¨**: å½“å‰å†…å­˜ â†’ å»ºè®® PostgreSQL + Redis
2. **WebSocket**: å½“å‰ HTTP è½®è¯¢ â†’ å»ºè®®å®æ—¶æ¨é€
3. **æˆæƒæ–¹å¼**: å½“å‰ ERC20 approve â†’ å»ºè®® Permit2
4. **å®Œæ•´æµ‹è¯•**: éœ€è¦å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
5. **ç›‘æ§å‘Šè­¦**: å»ºè®® Prometheus + Grafana
6. **åˆçº¦å®¡è®¡**: ç”Ÿäº§å‰éœ€è¦ä¸“ä¸šå®¡è®¡

### ğŸ“‹ å¯é€‰åŠŸèƒ½ï¼ˆæœªå®ç°ï¼‰

1. **P2P è®¢å•å¹¿æ’­**: å¯ä½¿ç”¨ 0x Mesh æˆ– libp2p
2. **å¤šé“¾æ”¯æŒ**: éƒ¨ç½²åˆ°å…¶ä»– EVM é“¾
3. **ç§»åŠ¨ç«¯åº”ç”¨**: React Native / Flutter
4. **æ›´å¤šå¸‚åœºç±»å‹**: é•¿æœŸå¸‚åœºã€äº‹ä»¶å¸‚åœºç­‰

## æ–‡ä»¶ç»“æ„

```
predictx/
â”œâ”€â”€ README.md                      # å®Œæ•´æ–‡æ¡£
â”œâ”€â”€ QUICK_START.md                 # 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹
â”œâ”€â”€ DEPLOYMENT_GUIDE.md            # è¯¦ç»†éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ PROJECT_SUMMARY.md             # æœ¬æ–‡ä»¶
â”œâ”€â”€ test-deployment.sh             # è‡ªåŠ¨åŒ–éƒ¨ç½²æµ‹è¯•è„šæœ¬
â”œâ”€â”€ .env.example                   # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ package.json                   # Monorepo æ ¹é…ç½®
â”œâ”€â”€ pnpm-workspace.yaml            # Workspace é…ç½®
â”‚
â”œâ”€â”€ chain/                         # æ™ºèƒ½åˆçº¦
â”‚   â”œâ”€â”€ contracts/
â”‚   â”‚   â”œâ”€â”€ ctf/                  # CTF æ ¸å¿ƒ
â”‚   â”‚   â”‚   â””â”€â”€ ConditionalTokensV2.sol  # CTF ä¸»åˆçº¦ (ERC1155)
â”‚   â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒåˆçº¦ V2
â”‚   â”‚   â”‚   â”œâ”€â”€ SettlementV2.sol         # è®¢å•ç»“ç®— + CTF é›†æˆ
â”‚   â”‚   â”‚   â””â”€â”€ MarketRegistryV2.sol     # å¸‚åœºç®¡ç† + Oracle
â”‚   â”‚   â”œâ”€â”€ oracle/               # Oracle é€‚é…
â”‚   â”‚   â”‚   â”œâ”€â”€ IPyth.sol
â”‚   â”‚   â”‚   â”œâ”€â”€ IMinuteOracle.sol
â”‚   â”‚   â”‚   â””â”€â”€ PythOracleAdapter.sol
â”‚   â”‚   â”œâ”€â”€ libs/                 # åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ Errors.sol
â”‚   â”‚   â”‚   â””â”€â”€ Types.sol
â”‚   â”‚   â””â”€â”€ mocks/                # æµ‹è¯•åˆçº¦
â”‚   â”‚       â””â”€â”€ MockUSDC.sol
â”‚   â”œâ”€â”€ deploy/                   # éƒ¨ç½²è„šæœ¬
â”‚   â”‚   â””â”€â”€ 00_deploy_all.ts
â”‚   â”œâ”€â”€ scripts/                  # è¾…åŠ©è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ mintUSDC.ts
â”‚   â”‚   â”œâ”€â”€ createMarkets.ts
â”‚   â”‚   â”œâ”€â”€ resolveMarket.ts
â”‚   â”‚   â”œâ”€â”€ testOracle.ts
â”‚   â”‚   â””â”€â”€ checkBalance.ts
â”‚   â”œâ”€â”€ hardhat.config.ts         # Hardhat é…ç½®
â”‚   â”œâ”€â”€ addresses.json            # éƒ¨ç½²åœ°å€ï¼ˆç”Ÿæˆï¼‰
â”‚   â””â”€â”€ markets.json              # å¸‚åœºä¿¡æ¯ï¼ˆç”Ÿæˆï¼‰
â”‚
â”œâ”€â”€ services/                     # åç«¯æœåŠ¡ V2
â”‚   â”œâ”€â”€ api/                      # REST API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ src/server.ts
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”œâ”€â”€ matcher/                  # æ’®åˆå¼•æ“
â”‚   â”‚   â”œâ”€â”€ src/matcher.ts
â”‚   â”‚   â”œâ”€â”€ src/orderbook.ts
â”‚   â”‚   â””â”€â”€ src/signature.ts
â”‚   â”œâ”€â”€ relayer/                  # ä¸­ç»§æœåŠ¡
â”‚   â”‚   â””â”€â”€ src/relayer.ts
â”‚   â”œâ”€â”€ runner.ts                 # ç»Ÿä¸€æœåŠ¡å¯åŠ¨
â”‚   â””â”€â”€ package.json
â”‚
â””â”€â”€ apps/
    â””â”€â”€ web/                      # React å‰ç«¯
        â”œâ”€â”€ src/
        â”‚   â”œâ”€â”€ App.tsx           # ä¸»åº”ç”¨
        â”‚   â”œâ”€â”€ main.tsx          # å…¥å£
        â”‚   â””â”€â”€ index.css         # æ ·å¼
        â”œâ”€â”€ index.html
        â”œâ”€â”€ vite.config.ts
        â””â”€â”€ package.json
```

## ä½¿ç”¨æµç¨‹

### å¼€å‘è€…è§†è§’

1. **éƒ¨ç½²**: `./test-deployment.sh` - ä¸€é”®éƒ¨ç½²æ‰€æœ‰åˆçº¦
2. **å¯åŠ¨**: å¯åŠ¨ API å’Œå‰ç«¯æœåŠ¡
3. **æµ‹è¯•**: è¿æ¥é’±åŒ…å¹¶ä¸‹å•æµ‹è¯•

### ç”¨æˆ·è§†è§’

1. **è¿æ¥**: è¿æ¥ MetaMask åˆ° Socrates Testnet
2. **é€‰æ‹©**: é€‰æ‹©ä¸€ä¸ªé¢„æµ‹å¸‚åœºï¼ˆ1m/3m/5mï¼‰
3. **äº¤æ˜“**: ä¸‹ä¹°å•æˆ–å–å•
4. **ç­‰å¾…**: ç­‰å¾…å¸‚åœºç»“ç®—
5. **èµå›**: èµ¢å®¶èµå› USDC

## æŠ€æœ¯äº®ç‚¹

### 1. æ¡ä»¶ä»£å¸æ¡†æ¶ï¼ˆCTFï¼‰
- å®Œæ•´å®ç° Gnosis CTF åè®®
- æ”¯æŒ split/merge/redeem æ“ä½œ
- ERC1155 åˆ° ERC20 åŒ…è£…

### 2. é“¾ä¸‹è®¢å•ç°¿ + é“¾ä¸Šç»“ç®—
- è®¢å•åœ¨é“¾ä¸‹åŒ¹é…ï¼ˆä½å»¶è¿Ÿï¼‰
- ç»“ç®—åœ¨é“¾ä¸Šæ‰§è¡Œï¼ˆé«˜å®‰å…¨ï¼‰
- EIP-712 ç­¾åéªŒè¯

### 3. Oracle æ•´åˆ†ä»·æ ¼
- ä½¿ç”¨ Pyth Oracle
- æ•´åˆ†é’Ÿæ—¶é—´æˆ³å¯¹é½
- å†å²ä»·æ ¼æŸ¥è¯¢æ”¯æŒ

### 4. æ¨¡å—åŒ–è®¾è®¡
- åˆçº¦èŒè´£æ¸…æ™°
- æ˜“äºæ‰©å±•å’Œç»´æŠ¤
- Monorepo ç®¡ç†

## æµ‹è¯•æŒ‡å—

### è‡ªåŠ¨åŒ–æµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´éƒ¨ç½²æµ‹è¯•
./test-deployment.sh
```

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

1. **åˆçº¦éƒ¨ç½²**
   ```bash
   cd chain
   pnpm deploy:soc
   ```

2. **é“¸é€  USDC**
   ```bash
   npx hardhat run scripts/mintUSDC.ts --network soc_test
   ```

3. **åˆ›å»ºå¸‚åœº**
   ```bash
   npx hardhat run scripts/createMarkets.ts --network soc_test
   ```

4. **æµ‹è¯• Oracle**
   ```bash
   npx hardhat run scripts/testOracle.ts --network soc_test
   ```

5. **å¯åŠ¨æœåŠ¡**
   ```bash
   # ç»ˆç«¯ 1
   cd services/api && pnpm dev

   # ç»ˆç«¯ 2
   cd apps/web && pnpm dev
   ```

6. **å‰ç«¯æµ‹è¯•**
   - è®¿é—® http://localhost:5173
   - è¿æ¥é’±åŒ…
   - ä¸‹å•æµ‹è¯•

7. **å¸‚åœºç»“ç®—**
   ```bash
   # ç­‰å¾…å¸‚åœºç»“æŸå
   npx hardhat run scripts/resolveMarket.ts --network soc_test
   ```

## ç”Ÿäº§åŒ–å»ºè®®

### é«˜ä¼˜å…ˆçº§
1. **æ•°æ®æŒä¹…åŒ–**: ä½¿ç”¨ PostgreSQL + Redis
2. **Permit2 é›†æˆ**: æ›¿æ¢ approve æˆæƒ
3. **æ‰¹é‡ç»“ç®—ä¼˜åŒ–**: å‡€é¢åŒ– + Gas ä¼˜åŒ–
4. **å®Œæ•´æµ‹è¯•**: å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•
5. **é”™è¯¯å¤„ç†**: å®Œå–„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### ä¸­ä¼˜å…ˆçº§
6. **WebSocket**: å®æ—¶è®¢å•ç°¿æ¨é€
7. **æ’®åˆå¼•æ“**: ä¸“ä¸šçš„é“¾ä¸‹æ’®åˆ
8. **ç›‘æ§å‘Šè­¦**: ç³»ç»Ÿå¥åº·ç›‘æ§
9. **å®¡è®¡**: æ™ºèƒ½åˆçº¦å®‰å…¨å®¡è®¡
10. **æ–‡æ¡£**: API æ–‡æ¡£å’Œç”¨æˆ·æŒ‡å—

### ä½ä¼˜å…ˆçº§
11. **P2P ç½‘ç»œ**: è®¢å•å¹¿æ’­
12. **å¤šé“¾æ”¯æŒ**: è·¨é“¾éƒ¨ç½²
13. **æ›´å¤šå¸‚åœº**: ETHã€å…¶ä»–èµ„äº§
14. **ç§»åŠ¨ç«¯**: ç§»åŠ¨åº”ç”¨

## æ€§èƒ½æŒ‡æ ‡ï¼ˆé¢„æœŸï¼‰

### åˆçº¦ Gas æ¶ˆè€—
- éƒ¨ç½²å…¨å¥—åˆçº¦: ~8,000,000 gas
- åˆ›å»ºå¸‚åœº: ~200,000 gas
- Split position: ~150,000 gas
- å•ç¬”ç»“ç®—: ~100,000 gas
- æ‰¹é‡ç»“ç®—ï¼ˆ10ç¬”ï¼‰: ~600,000 gas

### åç«¯æ€§èƒ½
- API å“åº”æ—¶é—´: < 100ms
- è®¢å•ç°¿æŸ¥è¯¢: < 50ms
- å¹¶å‘æ”¯æŒ: ~1000 req/s

## å®‰å…¨è€ƒè™‘

### å·²å®ç°
- âœ… EIP-712 ç­¾åéªŒè¯
- âœ… Nonce é˜²é‡æ”¾
- âœ… è®¢å•è¿‡æœŸæ£€æŸ¥
- âœ… Oracle ä»·æ ¼éªŒè¯

### éœ€å¢å¼º
- âš ï¸ åˆçº¦å®¡è®¡
- âš ï¸ Permit2 æˆæƒ
- âš ï¸ MEV ä¿æŠ¤
- âš ï¸ Rate limiting
- âš ï¸ DDoS é˜²æŠ¤

## å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

1. **è®¢å•å­˜å‚¨**: å½“å‰åœ¨å†…å­˜ä¸­ï¼Œé‡å¯ä¸¢å¤±
2. **æ’®åˆç®—æ³•**: ç®€åŒ–ç‰ˆï¼Œä¸æ”¯æŒéƒ¨åˆ†æˆäº¤
3. **Gas ä¼˜åŒ–**: æœªåšæ‰¹é‡ä¼˜åŒ–
4. **é”™è¯¯å¤„ç†**: åŸºç¡€å®ç°ï¼Œéœ€è¦å¢å¼º
5. **æµ‹è¯•è¦†ç›–**: ç¼ºå°‘è‡ªåŠ¨åŒ–æµ‹è¯•

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯: `git checkout -b feature/AmazingFeature`
3. æäº¤æ›´æ”¹: `git commit -m 'Add some AmazingFeature'`
4. æ¨é€åˆ†æ”¯: `git push origin feature/AmazingFeature`
5. æäº¤ Pull Request

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issueã€‚

---

**æ„Ÿè°¢ä½¿ç”¨ PredictX!** ğŸ‰
