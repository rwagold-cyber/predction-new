# PredictX V2 项目路线图与需求文档

## 📋 项目概述

**项目名称**: PredictX V2
**项目类型**: 基于 CTF 的去中心化预测市场平台
**目标**: 构建高性能、可扩展的短期价格预测市场（1/3/5 分钟）
**架构**: 链下订单簿 + 链上结算（混合架构）
**部署网络**: Socrates Testnet (Chain ID: 1111111)
**当前阶段**: MVP 完成，生产测试阶段

---

## 🎯 核心需求

### 1. 功能需求

#### 1.1 市场管理
- [x] 创建短期预测市场（BTC/ETH 涨跌）
- [x] 支持多时间框架（1/3/5 分钟）
- [x] 自动市场解决（Oracle 价格获取）
- [x] 自动市场发现（事件监听 + 定期扫描）
- [x] 市场状态管理（pending/active/ended）
- [ ] 市场取消机制
- [ ] 市场参数动态调整

#### 1.2 交易功能
- [x] 用户下单（限价单）
- [x] EIP-712 签名验证
- [x] 链下订单撮合
- [x] 批量链上结算
- [ ] 市价单支持
- [ ] 止损单/止盈单
- [ ] 订单部分取消
- [ ] 订单修改功能

#### 1.3 持仓管理
- [x] CTF (ERC1155) 持仓代币化
- [x] Split 操作（抵押品 → 结果代币）
- [x] Merge 操作（结果代币 → 抵押品）
- [x] Redeem 操作（赎回获胜代币）
- [ ] 批量 Split/Merge 优化
- [ ] 持仓转移功能
- [ ] 持仓历史查询

#### 1.4 Oracle 集成
- [x] Pyth Oracle 价格获取
- [x] 整分钟时间戳对齐
- [x] 历史价格查询
- [x] 价格验证机制
- [ ] 多 Oracle 聚合
- [ ] Oracle 故障容错
- [ ] 价格争议机制

### 2. 性能需求

#### 2.1 吞吐量
- [x] 链下撮合：< 1 秒延迟
- [x] 批量结算：10 笔/批
- [ ] 支持 1000+ TPS（链下撮合）
- [ ] 支持 10000+ 并发用户
- [ ] API 响应时间 < 50ms

#### 2.2 Gas 优化
- [x] 批量结算减少交易数
- [x] CTF 单次解决整个市场
- [ ] 订单净额化（netting）
- [ ] 跨市场批量结算
- [ ] Gas 价格智能调整

#### 2.3 可扩展性
- [x] CTF 支持数百万用户
- [x] 用户自主赎回（无需迭代）
- [ ] 水平扩展支持（多节点）
- [ ] 分片订单簿
- [ ] 跨链扩展

### 3. 安全需求

#### 3.1 智能合约安全
- [x] EIP-712 签名防重放
- [x] Nonce bitmap 防双花
- [x] ReentrancyGuard 防重入
- [x] 白名单抵押品
- [ ] 专业安全审计
- [ ] 时间锁机制
- [ ] 紧急暂停功能
- [ ] 多签管理

#### 3.2 后端安全
- [x] 订单签名验证
- [x] 订单过期检查
- [ ] Rate limiting
- [ ] DDoS 防护
- [ ] API 认证授权
- [ ] 数据加密传输

#### 3.3 MEV 防护
- [ ] 订单私密性（加密订单）
- [ ] 公平排序（FIFO）
- [ ] 最小价格变动限制
- [ ] 反抢跑机制

### 4. 用户体验需求

#### 4.1 前端功能
- [x] 钱包连接（MetaMask）
- [x] 市场列表展示
- [x] 订单簿可视化
- [x] 简单下单界面
- [ ] 高级交易界面
- [ ] K线图表展示
- [ ] 实时价格推送
- [ ] 持仓详情页
- [ ] 交易历史
- [ ] 损益统计

#### 4.2 移动端
- [ ] 响应式设计
- [ ] 移动端优化
- [ ] 原生 App（iOS/Android）

---

## 📊 当前进度总览

### 整体完成度：70%

```
智能合约层    ████████████████░░░░  80% (核心完成，待优化)
后端服务层    ███████████████░░░░░  75% (核心服务完成，待持久化/推送)
前端界面层    ████████░░░░░░░░░░░░  40% (基本可用，功能简陋)
测试覆盖      ████░░░░░░░░░░░░░░░░  20% (手动测试，缺自动化)
文档完善度    ████████████████████ 100% (文档齐全)
生产就绪度    ██████████░░░░░░░░░░  55% (测试网生产演练阶段)
```

---

## ✅ 已实现功能详情

### 智能合约层（V2 架构）

#### ConditionalTokensV2.sol
- ✅ ERC1155 标准实现
- ✅ `prepareCondition()` - 准备市场条件
- ✅ `reportPayouts()` - 报告市场结果
- ✅ `splitPosition()` - 分割持仓
- ✅ `mergePositions()` - 合并持仓
- ✅ `redeemPositions()` - 赎回收益
- ✅ 条件 ID 计算和管理
- ✅ 支付向量验证

#### SettlementV2.sol
- ✅ EIP-712 订单签名验证
- ✅ `batchFill()` - 批量成交
- ✅ Nonce bitmap 管理
- ✅ 抵押品托管（deposit/withdraw）
- ✅ 协议费累计
- ✅ CTF 自动调用（split/merge）
- ✅ 订单过期验证
- ✅ 价格精度：BPS (0-10000)

#### MarketRegistryV2.sol
- ✅ `createMarket()` - 创建市场
  - 参数：collateral, oracle, startTime, kind, timeframe
  - 支持：BTC_UPDOWN / ETH_UPDOWN
  - 时间框架：1/3/5 分钟
- ✅ `resolveMarket()` - 解决市场
- ✅ CTF 条件准备集成
- ✅ Oracle 价格获取
- ✅ 自动计算支付向量
- ✅ 市场状态管理

#### PythOracleAdapter.sol
- ✅ 整分钟价格获取
- ✅ 历史价格查询
- ✅ 时间戳对齐验证
- ✅ Pyth Oracle 集成

### 后端服务层（V2 架构）

#### API Server (services/api/)
- ✅ REST API 端点
  - `POST /api/v1/orders` - 提交订单
  - `GET /api/v1/orders/:id` - 查询订单状态
  - `GET /api/v1/orderbook/:marketId/:outcome` - 获取订单簿
  - `GET /api/v1/stats` - 统计信息
  - `GET /health` - 健康检查
- ✅ CORS 支持
- ✅ 错误处理
- ✅ 完整 API 文档

#### Matching Engine (services/matcher/)
- ✅ 价格-时间优先订单簿
- ✅ 自动撮合（1 秒周期）
- ✅ EIP-712 签名验证
- ✅ 订单状态追踪
- ✅ 部分成交支持
- ✅ 多市场并行处理
- ✅ 订单查询（`getOrderStatus`, `getOrderBookForAPI`）
- ✅ 精度统一（BPS + USDC 6 decimals）

#### Relayer (services/relayer/)
- ✅ 批量提交优化（10 笔/批）
- ✅ Gas 价格监控
- ✅ 自动重试机制（3次）
- ✅ 队列管理
- ✅ 失败处理和日志
- ✅ 统计信息输出

#### Runner (services/runner.ts)
- ✅ 统一服务启动
- ✅ Matcher + Relayer 协调
- ✅ 定期统计输出（30秒）
- ✅ 进程管理

### 前端应用层

#### Web App (apps/web/)
- ✅ 钱包连接（MetaMask）
- ✅ 网络检测和切换
- ✅ 市场列表展示
- ✅ 订单簿展示（买单/卖单）
- ✅ 简单下单界面
- ✅ 基础样式和布局

### 部署和工具

#### 部署脚本
- ✅ `deploy/00_deploy_all.ts` - 一键部署所有合约
- ✅ `scripts/mintUSDC.ts` - 铸造测试 USDC
- ✅ `scripts/createMarkets.ts` - 创建测试市场
- ✅ `scripts/resolveMarket.ts` - 解决市场
- ✅ `scripts/testOracle.ts` - 测试 Oracle
- ✅ `scripts/checkBalance.ts` - 检查余额
- ✅ `test-deployment.sh` - 自动化部署测试

#### 配置管理
- ✅ `.env.example` - 环境变量模板
- ✅ `addresses.json` - 部署地址自动生成
- ✅ `markets.json` - 市场信息自动生成
- ✅ Monorepo 配置（pnpm workspace）

### 文档

- ✅ README.md - 完整项目文档
- ✅ QUICK_START.md - 快速开始指南
- ✅ DEPLOYMENT_GUIDE.md - 详细部署指南
- ✅ PROJECT_SUMMARY.md - 项目总结
- ✅ PROJECT_STATUS.md - 完成状态报告
- ✅ ARCHITECTURE_V2.md - V2 架构详解
- ✅ PRECISION_FIXES.md - 精度修复文档
- ✅ DOCS_UPDATE_SUMMARY.md - 文档更新记录
- ✅ LEGACY_REMOVAL_SUMMARY.md - Legacy 清理记录
- ✅ services/api/README.md - API 完整文档

---

## ❌ 未实现功能和欠缺点

### 关键欠缺（阻碍生产使用）

#### 1. 数据持久化 🔴 **高优先级**

**当前状态**：
- ❌ 订单存储在内存中
- ❌ 服务重启后订单丢失
- ❌ 无历史数据查询

**需求**：
- [ ] PostgreSQL 数据库集成
  - 订单表（orders）
  - 成交表（fills）
  - 市场表（markets）
  - 用户表（users）
- [ ] Redis 缓存层
  - 热门订单簿缓存
  - 实时价格缓存
  - 用户会话缓存
- [ ] 数据备份和恢复
- [ ] 数据库迁移脚本

**影响**：无法追溯历史订单，用户体验差

---

#### 2. 授权方式升级 🔴 **高优先级**

**当前状态**：
- ❌ 使用 ERC20 `approve()` 授权
- ❌ 每个用户需要先 approve 再交易
- ❌ 用户体验不佳

**需求**：
- [ ] 集成 Uniswap Permit2
  - 一次授权，多次使用
  - 批量授权多个代币
  - Gas 成本降低
- [ ] 支持 EIP-2612 Permit
- [ ] 向下兼容 approve 方式

**影响**：用户体验差，Gas 成本高

---

#### 3. 测试覆盖 🔴 **高优先级**

**当前状态**：
- ❌ 无单元测试
- ❌ 无集成测试
- ❌ 仅手动测试
- ❌ 无测试覆盖率报告

**需求**：
- [ ] 智能合约测试（Hardhat）
  - CTF 功能测试
  - Settlement 功能测试
  - MarketRegistry 功能测试
  - Edge case 测试
  - Gas 消耗测试
- [ ] 后端服务测试（Jest/Mocha）
  - API 端点测试
  - Matcher 逻辑测试
  - Relayer 逻辑测试
  - 签名验证测试
- [ ] 端到端测试
  - 完整交易流程测试
  - 多用户场景测试
- [ ] 测试覆盖率目标：> 80%

**影响**：代码质量无保障，易出 bug

---

#### 4. 错误处理增强 🟡 **中优先级**

**当前状态**：
- ⚠️ 基础错误处理
- ⚠️ 错误信息不够详细
- ⚠️ 缺少错误码规范
- ⚠️ 无错误日志聚合

**需求**：
- [ ] 统一错误码系统
  - 合约错误码
  - API 错误码
  - 错误码文档
- [ ] 详细错误信息
  - 错误原因
  - 解决建议
  - 相关参数
- [ ] 错误日志系统
  - 结构化日志
  - 日志级别（debug/info/warn/error）
  - 日志聚合（ELK/Loki）
- [ ] 前端错误展示
  - 用户友好的错误提示
  - 错误重试机制

**影响**：问题排查困难，用户体验差

---

#### 5. 实时通信 🟡 **中优先级**

**当前状态**：
- ⚠️ HTTP 轮询获取订单簿
- ⚠️ 延迟高（> 1 秒）
- ⚠️ 浪费带宽

**需求**：
- [ ] WebSocket 服务器
  - Socket.io / ws
  - 订单簿实时推送
  - 成交记录推送
  - 市场状态推送
- [ ] 订阅/取消订阅机制
- [ ] 心跳检测和重连
- [ ] 消息压缩

**影响**：用户体验较差，无法实时看到市场变化

---

#### 6. 撮合引擎优化 🟡 **中优先级**

**当前状态**：
- ⚠️ 简化版撮合算法
- ⚠️ 不支持复杂订单类型
- ⚠️ 无撮合优先级优化

**需求**：
- [ ] 高级撮合算法
  - 部分成交优化
  - 最优价格匹配
  - 时间优先严格保证
- [ ] 更多订单类型
  - 市价单（Market Order）
  - 止损单（Stop Loss）
  - 止盈单（Take Profit）
  - 冰山订单（Iceberg）
- [ ] 性能优化
  - 订单簿索引优化
  - 内存池管理
  - 并发处理优化

**影响**：功能受限，性能不足以支撑高频交易

---

#### 7. 智能合约审计 🔴 **高优先级（生产前）**

**当前状态**：
- ❌ 未经审计
- ❌ 可能存在未知漏洞
- ❌ 不适合主网部署

**需求**：
- [ ] 专业审计机构审计
  - OpenZeppelin
  - Trail of Bits
  - Consensys Diligence
- [ ] 安全测试
  - Slither 静态分析
  - Echidna 模糊测试
  - Manticore 符号执行
- [ ] Bug Bounty 计划
- [ ] 审计报告公开

**影响**：主网部署存在重大安全风险

---

### 功能增强（提升用户体验）

#### 8. 前端功能完善 🟡 **中优先级**

**当前状态**：
- ⚠️ 功能简陋
- ⚠️ 缺少图表展示
- ⚠️ 无交易历史

**需求**：
- [ ] 高级交易界面
  - 专业订单簿视图
  - 深度图
  - K线图（TradingView）
  - 最新成交
- [ ] 持仓管理
  - 持仓详情
  - 未实现盈亏（PnL）
  - 持仓历史
- [ ] 交易历史
  - 订单历史
  - 成交历史
  - 资金流水
- [ ] 个人中心
  - 用户统计
  - 交易报告
  - 设置管理

**影响**：用户体验差，功能不完整

---

#### 9. 监控和告警 🟡 **中优先级**

**当前状态**：
- ⚠️ 仅有基础日志
- ⚠️ 无监控面板
- ⚠️ 无告警机制

**需求**：
- [ ] 监控系统
  - Prometheus + Grafana
  - 关键指标监控
    - API 响应时间
    - 撮合延迟
    - Gas 价格
    - 订单成交率
    - 错误率
  - 自定义仪表盘
- [ ] 告警系统
  - 服务宕机告警
  - Gas 价格异常告警
  - 错误率过高告警
  - 钱包余额不足告警
  - Telegram/Email 通知
- [ ] 日志聚合
  - ELK Stack / Loki
  - 日志查询和分析

**影响**：问题发现不及时，运维困难

---

#### 10. Gas 优化进阶 🟢 **低优先级**

**当前状态**：
- ✅ 基础批量结算
- ⚠️ 未做订单净额化

**需求**：
- [ ] 订单净额化（Netting）
  - 相同用户的买卖单抵消
  - 减少链上调用
- [ ] 跨市场批量结算
  - 一次交易处理多个市场
- [ ] Gas 价格智能调整
  - 根据网络拥堵动态调整
  - EIP-1559 支持
- [ ] 合约代码优化
  - 减少存储操作
  - 优化循环逻辑
  - 使用更高效的数据结构

**影响**：Gas 成本可进一步降低 20-30%

---

#### 11. 流动性激励 🟢 **低优先级**

**当前状态**：
- ❌ 无激励机制
- ❌ 可能缺少流动性

**需求**：
- [ ] 做市商激励计划
  - 挂单奖励
  - 交易量奖励
- [ ] 流动性挖矿
  - 代币奖励
  - 费用返还
- [ ] 推荐奖励
  - 邀请返佣
  - 交易手续费分成

**影响**：初期可能流动性不足

---

#### 12. 多链部署 🟢 **低优先级**

**当前状态**：
- ✅ 仅部署在 Socrates Testnet

**需求**：
- [ ] 支持更多 EVM 链
  - Ethereum
  - Arbitrum
  - Optimism
  - Polygon
  - Base
- [ ] 跨链流动性聚合
- [ ] 多链统一前端

**影响**：用户群体受限

---

#### 13. 隐私保护 🟢 **低优先级**

**当前状态**：
- ❌ 订单完全公开
- ❌ 可被抢跑（MEV）

**需求**：
- [ ] 订单加密
  - 私密订单提交
  - 时间延迟公开
- [ ] zkSNARK 隐私订单
  - 零知识证明验证
  - 完全隐私交易
- [ ] 公平排序
  - FIFO 严格保证
  - Flashbots 集成

**影响**：高频交易者可能被 MEV 攻击

---

#### 14. DAO 治理 🟢 **低优先级**

**当前状态**：
- ❌ 中心化管理
- ❌ 无社区参与

**需求**：
- [ ] 治理代币发行
- [ ] 提案和投票系统
- [ ] 参数调整权限
  - 协议费率
  - 最小订单金额
  - 支持的市场类型
- [ ] 资金池管理
- [ ] 多签管理

**影响**：项目中心化程度高

---

### 技术债务

#### 15. 代码重构需求

- [ ] API Server 拆分为微服务
- [ ] Matcher 性能瓶颈优化
- [ ] 前端组件化重构
- [ ] TypeScript 类型完善
- [ ] 代码注释补充

#### 16. 文档补充

- [ ] API 接口调用示例
- [ ] SDK 开发
- [ ] 合约接口文档
- [ ] 架构决策记录（ADR）
- [ ] 贡献指南

---

## 🏗️ 技术架构现状

### 智能合约层
```
ConditionalTokensV2 (CTF)
├── ERC1155 持仓代币
├── prepareCondition
├── reportPayouts
├── splitPosition
├── mergePositions
└── redeemPositions

SettlementV2
├── EIP-712 签名验证
├── batchFill (批量成交)
├── CTF 集成
├── 抵押品托管
└── 协议费管理

MarketRegistryV2
├── createMarket
├── resolveMarket
├── CTF 准备
└── Oracle 集成

PythOracleAdapter
├── 整分钟价格
├── 历史价格查询
└── 价格验证
```

### 后端服务层
```
services/
├── api/          # REST API (Express)
├── matcher/      # 撮合引擎 (内存订单簿)
├── relayer/      # 批量提交 (ethers.js)
└── runner.ts     # 统一启动
```

**缺失**：
- ❌ 数据库层（PostgreSQL）
- ❌ 缓存层（Redis）
- ❌ 消息队列（RabbitMQ/Kafka）
- ❌ WebSocket 服务

### 前端应用层
```
apps/web/
├── React + Vite
├── ethers.js v6
└── 基础交易界面
```

**缺失**：
- ❌ 状态管理（Redux/Zustand）
- ❌ 图表库（TradingView）
- ❌ WebSocket 客户端
- ❌ UI 组件库（Ant Design/Material-UI）

---

## 📅 建议开发路线图

### Phase 1: 生产就绪（1-2 个月）🔴

**目标**: 可以安全上线主网

1. **Week 1-2: 数据持久化**
   - [ ] PostgreSQL 数据库设计和集成
   - [ ] Redis 缓存层搭建
   - [ ] 数据迁移脚本
   - [ ] 订单历史查询 API

2. **Week 3-4: Permit2 集成**
   - [ ] Permit2 合约集成
   - [ ] Settlement 合约适配
   - [ ] 前端签名流程更新
   - [ ] 向下兼容测试

3. **Week 5-6: 测试覆盖**
   - [ ] 智能合约单元测试（> 80%）
   - [ ] 后端服务测试（> 70%）
   - [ ] 端到端测试
   - [ ] 测试报告

4. **Week 7-8: 安全审计准备**
   - [ ] 代码审查和修复
   - [ ] Slither 静态分析
   - [ ] 安全测试
   - [ ] 提交审计申请

**交付物**：
- ✅ 持久化存储系统
- ✅ Permit2 授权支持
- ✅ 完整测试覆盖
- ✅ 审计就绪代码

---

### Phase 2: 用户体验提升（2-3 个月）🟡

**目标**: 提升用户体验和功能完整性

1. **Week 1-2: WebSocket 实时推送**
   - [ ] WebSocket 服务器搭建
   - [ ] 订单簿实时推送
   - [ ] 前端 WebSocket 集成
   - [ ] 性能测试

2. **Week 3-4: 前端功能增强**
   - [ ] TradingView 图表集成
   - [ ] 持仓管理页面
   - [ ] 交易历史页面
   - [ ] 个人中心

3. **Week 5-6: 错误处理增强**
   - [ ] 统一错误码系统
   - [ ] 详细错误信息
   - [ ] 日志聚合系统
   - [ ] 错误监控面板

4. **Week 7-8: 撮合引擎优化**
   - [ ] 市价单支持
   - [ ] 止损/止盈单
   - [ ] 性能优化
   - [ ] 压力测试

**交付物**：
- ✅ 实时数据推送
- ✅ 完整前端界面
- ✅ 高级订单类型
- ✅ 完善错误处理

---

### Phase 3: 规模化运营（3-6 个月）🟢

**目标**: 支持大规模用户和扩展功能

1. **Month 1: 监控和告警**
   - [ ] Prometheus + Grafana
   - [ ] 自定义监控面板
   - [ ] 告警系统
   - [ ] 运维手册

2. **Month 2: Gas 优化和激励**
   - [ ] 订单净额化
   - [ ] 跨市场批量结算
   - [ ] 流动性激励计划
   - [ ] 做市商计划

3. **Month 3: 多链部署**
   - [ ] Arbitrum 部署
   - [ ] Optimism 部署
   - [ ] 跨链流动性
   - [ ] 多链前端

4. **Month 4-6: 高级功能**
   - [ ] 移动端 App
   - [ ] 更多市场类型
   - [ ] API SDK 发布
   - [ ] 第三方集成

**交付物**：
- ✅ 完整监控系统
- ✅ 多链支持
- ✅ 流动性激励
- ✅ 移动端应用

---

### Phase 4: 去中心化（6+ 个月）🔵

**目标**: 项目去中心化和社区治理

1. **治理代币**
   - [ ] 代币经济学设计
   - [ ] 代币合约开发
   - [ ] 空投计划
   - [ ] 流动性挖矿

2. **DAO 治理**
   - [ ] 提案系统
   - [ ] 投票系统
   - [ ] 参数调整权限
   - [ ] 多签管理

3. **隐私保护**
   - [ ] 订单加密
   - [ ] zkSNARK 研究
   - [ ] MEV 防护
   - [ ] 公平排序

4. **生态建设**
   - [ ] Bug Bounty
   - [ ] Grant 计划
   - [ ] 开发者文档
   - [ ] 社区运营

**交付物**：
- ✅ DAO 治理系统
- ✅ 隐私订单
- ✅ 去中心化运营
- ✅ 开发者生态

---

## 📈 关键指标（KPI）

### 当前指标

| 指标 | 当前值 | 目标值 | 优先级 |
|------|--------|--------|--------|
| 智能合约完成度 | 80% | 100% | 🔴 |
| 后端服务完成度 | 60% | 90% | 🔴 |
| 前端功能完成度 | 40% | 80% | 🟡 |
| 测试覆盖率 | 20% | 80% | 🔴 |
| 文档完整度 | 100% | 100% | ✅ |
| API 响应时间 | ~100ms | <50ms | 🟡 |
| 撮合延迟 | ~5s | <1s | 🟡 |
| Gas 优化 | 基础 | 高级 | 🟢 |
| 安全审计 | 未审计 | 已审计 | 🔴 |

### 业务指标（待上线后）

- [ ] 日活用户（DAU）
- [ ] 日交易量（Daily Volume）
- [ ] 总锁仓量（TVL）
- [ ] 订单成交率
- [ ] 平均持仓时间
- [ ] 用户留存率
- [ ] 协议收入

---

## ⚠️ 已知问题和风险

### 技术风险

1. **订单丢失风险** 🔴
   - 问题：内存存储，服务重启丢失
   - 影响：用户损失
   - 缓解：尽快集成数据库

2. **合约漏洞风险** 🔴
   - 问题：未经审计
   - 影响：资金安全
   - 缓解：主网前必须审计

3. **性能瓶颈风险** 🟡
   - 问题：单节点，无水平扩展
   - 影响：无法支撑大量用户
   - 缓解：架构升级

4. **Oracle 故障风险** 🟡
   - 问题：单一 Oracle 依赖
   - 影响：市场无法解决
   - 缓解：多 Oracle 聚合

### 业务风险

1. **流动性不足** 🟡
   - 问题：初期可能无做市商
   - 影响：订单无法成交
   - 缓解：流动性激励计划

2. **监管风险** 🟢
   - 问题：预测市场可能受监管
   - 影响：部分地区无法使用
   - 缓解：合规咨询

3. **竞争风险** 🟢
   - 问题：市场有其他预测平台
   - 影响：用户分流
   - 缓解：差异化功能

---

## 🎯 近期行动计划（30 天）

### Week 1-2: 数据持久化

- [ ] 设计数据库 schema
- [ ] 搭建 PostgreSQL
- [ ] 实现订单持久化
- [ ] 实现成交记录持久化
- [ ] API 适配数据库查询

### Week 3: Permit2 研究

- [ ] 研究 Permit2 接口
- [ ] 设计集成方案
- [ ] 编写示例代码
- [ ] 测试验证

### Week 4: 测试框架搭建

- [ ] 搭建 Hardhat 测试环境
- [ ] 编写合约测试用例
- [ ] 搭建后端测试环境
- [ ] 编写 API 测试用例

**月度目标**：
- ✅ 订单持久化完成
- ✅ Permit2 集成方案确定
- ✅ 测试框架搭建完成
- ✅ 测试覆盖率 > 30%

---

## 📞 反馈和建议

本路线图是动态文档，会根据开发进度和市场反馈持续更新。

**文档版本**: v1.0
**创建时间**: 2025-10-29
**下次更新**: 根据开发进度更新

---

**项目当前状态**: ✅ MVP 完成，进入生产就绪阶段
**下一里程碑**: 数据持久化 + Permit2 集成 + 测试覆盖
**预计主网上线**: 完成安全审计后 2-3 个月
